import{bE as Q,bF as e,bG as yt,bH as Ae,bI as St,bJ as vt,r as l,bK as Oe,bL as Ct,bM as bt,bN as jt,bO as wt,bP as Tt,bQ as kt,bR as Nt,bS as Lt,bT as At,bU as It,bV as Pt,bW as Ie,bX as Et}from"./vendor-3b0eb66e.js";import{D as Be,S as v,I as Pe,P as Rt,T as pe,a as Mt,B as fe,b as qt,c as ue,d as Ue,C as Gt,e as Ee,L as Ot,f as Bt,g as Ut,h as Re,i as zt,j as $t,k as Ft,l as M,m as Vt,n as Ht,o as Dt}from"./fluentui-react-cc049b91.js";import{e as Qt,E as Kt,f as Wt,g as Jt,D as Xt,h as Yt}from"./fluentui-icons-cc979dd7.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const r of u.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function c(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}})();const Zt=".auth/me",es=".auth/refresh",ts=".auth/logout?post_logout_redirect_uri=/";async function ss(){const t=await fetch("/auth_setup");if(!t.ok)throw new Error(`auth setup response was not ok: ${t.status}`);return await t.json()}const U=await ss(),P=U.useLogin,D=U.requireAccessControl,ns=U.msalConfig,os=U.loginRequest,as=U.tokenRequest,ze=()=>window.location.origin+U.msalConfig.auth.redirectUri,rs=()=>fetch(es).then(t=>t.ok?fetch(Zt).then(s=>s.ok?s.json().then(n=>n.length>0?{id_token:n[0].id_token,access_token:n[0].access_token,user_claims:n[0].user_claims.reduce((c,o)=>(c[o.typ]=o.val,c),{})}:null):null):null),q=await rs(),is=()=>{window.location.href=ts},ge=t=>t?.getActiveAccount()!=null||q!=null,me=t=>q?Promise.resolve(q.access_token):t.acquireTokenSilent({...as,redirectUri:ze()}).then(s=>s.accessToken).catch(s=>{console.log(s)});const cs="/assets/github-fab00c2d.svg",ls="_layout_o4bzc_1",us="_header_o4bzc_13",ds="_headerContainer_o4bzc_23",hs="_headerTitleContainer_o4bzc_39",ps="_headerLogo_o4bzc_55",gs="_headerTitle_o4bzc_39",ms="_headerNavList_o4bzc_73",_s="_headerNavPageLink_o4bzc_85",xs="_headerNavPageLinkActive_o4bzc_113",fs="_headerNavLeftMargin_o4bzc_123",ys="_headerRightText_o4bzc_131",Ss="_microsoftLogo_o4bzc_141",vs="_githubLogo_o4bzc_151",C={layout:ls,header:us,headerContainer:ds,headerTitleContainer:hs,headerLogo:ps,headerTitle:gs,headerNavList:ms,headerNavPageLink:_s,headerNavPageLinkActive:xs,headerNavLeftMargin:fs,headerRightText:ys,microsoftLogo:Ss,githubLogo:vs},Cs="_loginButton_l76ou_1",bs={loginButton:Cs},js=()=>{const{instance:t}=Q(),s=t.getActiveAccount(),n=(s||q)!=null,c=()=>{t.loginPopup({...os,redirectUri:ze()}).catch(r=>console.log(r))},o=()=>{s?t.logoutPopup({mainWindowRedirectUri:"/",account:t.getActiveAccount()}).catch(r=>console.log(r)):is()},u=`Logout
${s?.username??q?.user_claims?.preferred_username}`;return e.jsx(Be,{text:n?u:"Login",className:bs.loginButton,onClick:n?o:c})},Me=()=>e.jsxs("div",{className:C.layout,children:[e.jsx("header",{className:C.header,role:"banner",children:e.jsxs("div",{className:C.headerContainer,children:[e.jsx(yt,{to:"/",className:C.headerTitleContainer,children:e.jsx("h3",{className:C.headerTitle,children:"GPT + Enterprise data | Sample"})}),e.jsx("nav",{children:e.jsxs("ul",{className:C.headerNavList,children:[e.jsx("li",{children:e.jsx(Ae,{to:"/",className:({isActive:t})=>t?C.headerNavPageLinkActive:C.headerNavPageLink,children:"Chat"})}),e.jsx("li",{className:C.headerNavLeftMargin,children:e.jsx(Ae,{to:"/qa",className:({isActive:t})=>t?C.headerNavPageLinkActive:C.headerNavPageLink,children:"Ask a question"})}),e.jsx("li",{className:C.headerNavLeftMargin,children:e.jsx("a",{href:"https://aka.ms/entgptsearch",target:"_blank",title:"Github repository link",children:e.jsx("img",{src:cs,alt:"Github logo","aria-label":"Link to github repository",width:"20px",height:"20px",className:C.githubLogo})})})]})}),e.jsx("h4",{className:C.headerRightText,children:"Azure OpenAI + AI Search"}),P&&e.jsx(js,{})]})}),e.jsx(St,{})]}),ws="_container_1qf1y_1",Ts="_chatRoot_1qf1y_15",ks="_chatContainer_1qf1y_25",Ns="_chatEmptyState_1qf1y_41",Ls="_chatEmptyStateTitle_1qf1y_61",As="_chatEmptyStateSubtitle_1qf1y_75",Is="_chatMessageStream_1qf1y_107",Ps="_chatMessageGpt_1qf1y_131",Es="_chatMessageGptMinWidth_1qf1y_145",Rs="_chatInput_1qf1y_155",Ms="_chatAnalysisPanel_1qf1y_181",qs="_chatSettingsSeparator_1qf1y_197",Gs="_loadingLogo_1qf1y_205",Os="_commandsContainer_1qf1y_213",Bs="_commandButton_1qf1y_223",p={container:ws,chatRoot:Ts,chatContainer:ks,chatEmptyState:Ns,chatEmptyStateTitle:Ls,chatEmptyStateSubtitle:As,chatMessageStream:Is,chatMessageGpt:Ps,chatMessageGptMinWidth:Es,chatInput:Rs,chatAnalysisPanel:Ms,chatSettingsSeparator:qs,loadingLogo:Gs,commandsContainer:Os,commandButton:Bs},ne="";function oe(t){var s={"Content-Type":"application/json"};return P&&q==null&&t&&(s.Authorization=`Bearer ${t}`),s}async function eo(t,s){const n=await fetch(`${ne}/ask`,{method:"POST",headers:oe(s),body:JSON.stringify(t)}),c=await n.json();if(n.status>299||!n.ok)throw Error(c.error||"Unknown error");return c}async function Us(t){return await(await fetch(`${ne}/config`,{method:"GET",headers:oe(t)})).json()}async function zs(t,s){return await fetch(`${ne}/chat`,{method:"POST",headers:oe(s),body:JSON.stringify(t)})}function $e(t){return`${ne}/content/${t}`}var b=(t=>(t.Hybrid="hybrid",t.Vectors="vectors",t.Text="text",t))(b||{}),I=(t=>(t.TextAndImages="textAndImages",t.Images="images",t.Texts="texts",t))(I||{}),N=(t=>(t.Embedding="embedding",t.ImageEmbedding="imageEmbedding",t.Both="both",t))(N||{});const $s="_answerContainer_1pvw0_1",Fs="_answerLogo_1pvw0_21",Vs="_answerText_1pvw0_29",Hs="_selected_1pvw0_67",Ds="_citationLearnMore_1pvw0_75",Qs="_citation_1pvw0_75",Ks="_followupQuestionsList_1pvw0_119",Ws="_followupQuestionLearnMore_1pvw0_127",Js="_followupQuestion_1pvw0_119",Xs="_supContainer_1pvw0_165",Ys="_retryButton_1pvw0_223",Zs="_loadingdots_1pvw0_267",en="_loading_1pvw0_267",j={answerContainer:$s,answerLogo:Fs,answerText:Vs,selected:Hs,citationLearnMore:Ds,citation:Qs,followupQuestionsList:Ks,followupQuestionLearnMore:Ws,followupQuestion:Js,supContainer:Xs,retryButton:Ys,loadingdots:Zs,loading:en};function tn(t,s,n){const c=[];let o=t.trim();if(s){let d=o.length;for(let g=o.length-1;g>=0&&o[g]!=="]";g--)if(o[g]==="["){d=g;break}o=o.substring(0,d)}return{answerHtml:o.split(/\[([^\]]+)\]/g).map((d,_)=>{if(_%2===0)return d;{let g;c.indexOf(d)!==-1?g=c.indexOf(d)+1:(c.push(d),g=c.length);const h=$e(d);return vt(e.jsx("a",{className:"supContainer",title:d,onClick:()=>n(h),children:e.jsx("sup",{children:g})}))}}).join(""),citations:c}}const Fe=()=>e.jsx(Qt,{primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Answer logo"}),qe=({answer:t,isSelected:s,isStreaming:n,onCitationClicked:c,onThoughtProcessClicked:o,onSupportingContentClicked:u,onFollowupQuestionClicked:r,showFollowupQuestions:d})=>{const _=t.choices[0].context.followup_questions,g=t.choices[0].message.content,h=l.useMemo(()=>tn(g,n,c),[t]),m=Oe.sanitize(h.answerHtml);return e.jsxs(v,{className:`${j.answerContainer} ${s&&j.selected}`,verticalAlign:"space-between",children:[e.jsx(v.Item,{children:e.jsxs(v,{horizontal:!0,horizontalAlign:"space-between",children:[e.jsx(Fe,{}),e.jsxs("div",{children:[e.jsx(Pe,{style:{color:"black"},iconProps:{iconName:"Lightbulb"},title:"Show thought process",ariaLabel:"Show thought process",onClick:()=>o(),disabled:!t.choices[0].context.thoughts?.length}),e.jsx(Pe,{style:{color:"black"},iconProps:{iconName:"ClipboardList"},title:"Show supporting content",ariaLabel:"Show supporting content",onClick:()=>u(),disabled:!t.choices[0].context.data_points})]})]})}),e.jsx(v.Item,{grow:!0,children:e.jsx("div",{className:j.answerText,dangerouslySetInnerHTML:{__html:m}})}),!!h.citations.length&&e.jsx(v.Item,{children:e.jsxs(v,{horizontal:!0,wrap:!0,tokens:{childrenGap:5},children:[e.jsx("span",{className:j.citationLearnMore,children:"Citations:"}),h.citations.map((x,y)=>{const k=$e(x);return e.jsx("a",{className:j.citation,title:x,onClick:()=>c(k),children:`${++y}. ${x}`},y)})]})}),!!_?.length&&d&&r&&e.jsx(v.Item,{children:e.jsxs(v,{horizontal:!0,wrap:!0,className:`${h.citations.length?j.followupQuestionsList:""}`,tokens:{childrenGap:6},children:[e.jsx("span",{className:j.followupQuestionLearnMore,children:"Follow-up questions:"}),_.map((x,y)=>e.jsx("a",{className:j.followupQuestion,title:x,onClick:()=>r(x),children:`${x}`},y))]})})]})},sn=()=>{const t=Ct({from:{opacity:0},to:{opacity:1}});return e.jsx(bt.div,{style:{...t},children:e.jsxs(v,{className:j.answerContainer,verticalAlign:"space-between",children:[e.jsx(Fe,{}),e.jsx(v.Item,{grow:!0,children:e.jsxs("p",{className:j.answerText,children:["Generating answer",e.jsx("span",{className:j.loadingdots})]})})]})})},nn=({error:t,onRetry:s})=>e.jsxs(v,{className:j.answerContainer,verticalAlign:"space-between",children:[e.jsx(Kt,{"aria-hidden":"true","aria-label":"Error icon",primaryFill:"red"}),e.jsx(v.Item,{grow:!0,children:e.jsx("p",{className:j.answerText,children:t})}),e.jsx(Rt,{className:j.retryButton,onClick:s,text:"Retry"})]}),on="_questionInputContainer_1nmg4_1",an="_questionInputTextArea_1nmg4_23",rn="_questionInputButtonsContainer_1nmg4_33",de={questionInputContainer:on,questionInputTextArea:an,questionInputButtonsContainer:rn},cn=({onSend:t,disabled:s,placeholder:n,clearOnSend:c,initQuestion:o})=>{const[u,r]=l.useState("");l.useEffect(()=>{o&&r(o)},[o]);const d=()=>{s||!u.trim()||(t(u),c&&r(""))},_=y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),d())},g=(y,k)=>{k?k.length<=1e3&&r(k):r("")},{instance:h}=Q(),m=D&&!ge(h),x=s||!u.trim()||m;return m&&(n="Please login to continue..."),e.jsxs(v,{horizontal:!0,className:de.questionInputContainer,children:[e.jsx(pe,{className:de.questionInputTextArea,disabled:m,placeholder:n,multiline:!0,resizable:!1,borderless:!0,value:u,onChange:g,onKeyDown:_}),e.jsx("div",{className:de.questionInputButtonsContainer,children:e.jsx(Mt,{content:"Ask question button",relationship:"label",children:e.jsx(fe,{size:"large",icon:e.jsx(Wt,{primaryFill:"rgba(115, 118, 225, 1)"}),disabled:x,onClick:d})})})]})},ln="_examplesNavList_1qnco_1",un="_example_1qnco_1",dn="_exampleText_1qnco_57",_e={examplesNavList:ln,example:un,exampleText:dn},hn=({text:t,value:s,onClick:n})=>e.jsx("div",{className:_e.example,onClick:()=>n(s),children:e.jsx("p",{className:_e.exampleText,children:t})}),pn=["What is included in my Northwind Health Plus plan that is not in standard?","What happens in a performance review?","What does a Product Manager do?"],gn=["Compare the impact of interest rates and GDP in financial markets.","What is the expected trend for the S&P 500 index over the next five years? Compare it to the past S&P 500 performance","Can you identify any correlation between oil prices and stock market trends?"],mn=({onExampleClicked:t,useGPT4V:s})=>e.jsx("ul",{className:_e.examplesNavList,children:(s?gn:pn).map((n,c)=>e.jsx("li",{children:e.jsx(hn,{text:n,value:n,onClick:t})},c))}),_n="_container_1atyp_1",xn="_message_1atyp_17",Ge={container:_n,message:xn},se=({message:t})=>e.jsx("div",{className:Ge.container,children:e.jsx("div",{className:Ge.message,children:t})}),fn="_thoughtProcess_kfzeg_1",yn="_tList_kfzeg_15",Sn="_tListItem_kfzeg_27",vn="_tStep_kfzeg_79",Cn="_tCodeBlock_kfzeg_91",bn="_tProp_kfzeg_99",jn="_citationImg_kfzeg_115",B={thoughtProcess:fn,tList:yn,tListItem:Sn,tStep:vn,tCodeBlock:Cn,tProp:bn,citationImg:jn};function wn(t){const s=t.split(": "),n=s[0],c=Oe.sanitize(s.slice(1).join(": "));return{title:n,content:c}}const Tn="_supportingContentNavList_17cb2_1",kn="_supportingContentItem_17cb2_17",Nn="_supportingContentItemHeader_17cb2_45",Ln="_supportingContentItemText_17cb2_53",An="_supportingContentItemImage_17cb2_63",H={supportingContentNavList:Tn,supportingContentItem:kn,supportingContentItemHeader:Nn,supportingContentItemText:Ln,supportingContentItemImage:An},In=({supportingContent:t})=>{const s=Array.isArray(t)?t:t.text,n=Array.isArray(t)?[]:t?.images;return e.jsxs("ul",{className:H.supportingContentNavList,children:[s.map((c,o)=>{const u=wn(c);return e.jsxs("li",{className:H.supportingContentItem,children:[e.jsx("h4",{className:H.supportingContentItemHeader,children:u.title}),e.jsx("p",{className:H.supportingContentItemText,dangerouslySetInnerHTML:{__html:u.content}})]},o)}),n?.map((c,o)=>e.jsx("img",{className:H.supportingContentItemImage,src:c.url},o))]})};var L=(t=>(t.ThoughtProcessTab="thoughtProcess",t.SupportingContentTab="supportingContent",t.CitationTab="citation",t))(L||{});const Pn=({thoughts:t})=>e.jsx("ul",{className:B.tList,children:t.map((s,n)=>e.jsxs("li",{className:B.tListItem,children:[e.jsx("div",{className:B.tStep,children:s.title}),Array.isArray(s.description)?e.jsx(jt,{language:"json",wrapLongLines:!0,className:B.tCodeBlock,children:JSON.stringify(s.description,null,2)}):e.jsxs(e.Fragment,{children:[e.jsx("div",{children:s.description}),e.jsx(v,{horizontal:!0,tokens:{childrenGap:5},children:s.props&&(Object.keys(s.props)||[]).map(c=>e.jsxs("span",{className:B.tProp,children:[c,": ",JSON.stringify(s.props?.[c])]}))})]})]},n))}),he={disabled:!0,style:{color:"grey"}},En=({answer:t,activeTab:s,activeCitation:n,citationHeight:c,className:o,onActiveTabChanged:u})=>{const r=!t.choices[0].context.thoughts,d=!t.choices[0].context.data_points,_=!n,[g,h]=l.useState(""),m=P?Q().instance:void 0,x=async()=>{const y=m?await me(m):void 0;if(n){const k=n.indexOf("#")?n.split("#")[1]:"",K=await(await fetch(n,{method:"GET",headers:oe(y)})).blob();let W=URL.createObjectURL(K);k&&(W+="#"+k),h(W)}};return l.useEffect(()=>{x()},[]),e.jsxs(qt,{className:o,selectedKey:s,onLinkClick:y=>y&&u(y.props.itemKey),children:[e.jsx(ue,{itemKey:L.ThoughtProcessTab,headerText:"Thought process",headerButtonProps:r?he:void 0,children:e.jsx(Pn,{thoughts:t.choices[0].context.thoughts||[]})}),e.jsx(ue,{itemKey:L.SupportingContentTab,headerText:"Supporting content",headerButtonProps:d?he:void 0,children:e.jsx(In,{supportingContent:t.choices[0].context.data_points})}),e.jsx(ue,{itemKey:L.CitationTab,headerText:"Citation",headerButtonProps:_?he:void 0,children:n?.endsWith(".png")?e.jsx("img",{src:g,className:B.citationImg}):e.jsx("iframe",{title:"Citation",src:g,width:"100%",height:c})})]})},Rn="_container_1k5c7_1",Mn={container:Rn},qn=({className:t,onClick:s})=>e.jsx("div",{className:`${Mn.container} ${t??""}`,children:e.jsx(fe,{icon:e.jsx(Jt,{}),onClick:s,children:"Developer settings"})}),Gn="_container_1k5c7_1",On={container:Gn},Bn=({className:t,disabled:s,onClick:n})=>e.jsx("div",{className:`${On.container} ${t??""}`,children:e.jsx(fe,{icon:e.jsx(Xt,{}),disabled:s,onClick:n,children:"Clear chat"})}),Un="_container_1142u_1",zn={container:Un},$n=[{key:N.Embedding,text:"Text Embeddings"},{key:N.ImageEmbedding,text:"Image Embeddings"},{key:N.Both,text:"Text and Image embeddings"}],Fn=({updateRetrievalMode:t,updateVectorFields:s,showImageOptions:n})=>{const[c,o]=l.useState(b.Hybrid),[u,r]=l.useState(),d=(g,h)=>{o(h?.data||b.Hybrid),t(h?.data||b.Hybrid)},_=(g,h)=>{h&&r(h.key);let m;h?.key==="both"?m=[N.Embedding,N.ImageEmbedding]:m=[h?.key],s(m)};return l.useEffect(()=>{s(n?[N.Embedding,N.ImageEmbedding]:[N.Embedding])},[n]),e.jsxs(v,{className:zn.container,tokens:{childrenGap:10},children:[e.jsx(Ue,{label:"Retrieval mode",options:[{key:"hybrid",text:"Vectors + Text (Hybrid)",selected:c==b.Hybrid,data:b.Hybrid},{key:"vectors",text:"Vectors",selected:c==b.Vectors,data:b.Vectors},{key:"text",text:"Text",selected:c==b.Text,data:b.Text}],required:!0,onChange:d}),n&&[b.Vectors,b.Hybrid].includes(c)&&e.jsx(Gt,{options:$n,onChange:_,selectedKey:u,defaultSelectedKey:N.Both,label:"Vector Fields (Multi-query vector search)"})]})},Vn=()=>{const{instance:t}=Q(),s=t.getActiveAccount(),n=r=>typeof r=="string"?r:JSON.stringify(r),o=(r=>Object.keys(r??{}).map(d=>{let _=d;try{const h=new URL(d).pathname.split("/");d=h[h.length-1]}catch{}return{name:d,value:n((r??{})[_])}}))(s?.idTokenClaims??q?.user_claims),u=[Ee({columnId:"name",compare:(r,d)=>r.name.localeCompare(d.name),renderHeaderCell:()=>"Name",renderCell:r=>r.name}),Ee({columnId:"value",compare:(r,d)=>r.value.localeCompare(d.value),renderHeaderCell:()=>"Value",renderCell:r=>r.value})];return e.jsxs("div",{children:[e.jsx(Ot,{children:"ID Token Claims"}),e.jsxs(Bt,{items:o,columns:u,sortable:!0,getRowId:r=>r.name,children:[e.jsx(Ut,{children:e.jsx(Re,{children:({renderHeaderCell:r})=>e.jsx(zt,{children:r()})})}),e.jsx($t,{children:({item:r,rowId:d})=>e.jsx(Re,{children:({renderCell:_})=>e.jsx(Ft,{children:_(r)})},d)})]})]})},Hn="_container_1142u_1",Dn={container:Hn},Qn=({updateGPT4VInputs:t,updateUseGPT4V:s,isUseGPT4V:n,gpt4vInputs:c})=>{const[o,u]=l.useState(n),[r,d]=l.useState(c||I.TextAndImages),_=(h,m)=>{s(!!m),u(!!m)},g=(h,m)=>{if(m){const x=m.key;t(x||I.TextAndImages),x&&d(x)}};return l.useEffect(()=>{o&&t(I.TextAndImages)},[o]),e.jsxs(v,{className:Dn.container,tokens:{childrenGap:10},children:[e.jsx(M,{checked:o,label:"Use GPT-4 Turbo with Vision",onChange:_}),o&&e.jsx(Ue,{selectedKey:r,label:"GPT-4 Turbo with Vision Inputs",options:[{key:I.TextAndImages,text:"Images and text from index"},{text:"Images only",key:I.Images},{text:"Text only",key:I.Texts}],required:!0,onChange:g})]})},Kn=()=>{const[t,s]=l.useState(!1),[n,c]=l.useState(""),[o,u]=l.useState(.3),[r,d]=l.useState(3),[_,g]=l.useState(b.Hybrid),[h,m]=l.useState(!0),[x,y]=l.useState(!0),[k,ye]=l.useState(!1),[K,W]=l.useState(""),[J,Ve]=l.useState(!1),[He,De]=l.useState([N.Embedding]),[Se,Qe]=l.useState(!1),[ve,Ke]=l.useState(!1),[Ce,We]=l.useState(I.TextAndImages),[X,Je]=l.useState(!1),E=l.useRef(""),ae=l.useRef(null),[Y,Z]=l.useState(!1),[be,re]=l.useState(!1),[ee,ie]=l.useState(),[je,ce]=l.useState(),[z,G]=l.useState(void 0),[$,we]=l.useState(0),[w,te]=l.useState([]),[Te,ke]=l.useState([]),[Ne,Xe]=l.useState(!1),[Ye,Ze]=l.useState(!1),[et,tt]=l.useState(!1),st=async()=>{const i=O?await me(O):void 0;Us(i).then(a=>{Xe(a.showGPT4VOptions),m(a.showSemanticRankerOption),Ze(a.showSemanticRankerOption),tt(a.showVectorOption),a.showVectorOption||g(b.Text)})},nt=async(i,a,T,le)=>{let A="",f={};const _t=S=>new Promise(xt=>{setTimeout(()=>{A+=S;const ft={...f,choices:[{...f.choices[0],message:{content:A,role:f.choices[0].message.role}}]};ke([...a,[i,ft]]),xt(null)},33)});try{re(!0);for await(const S of wt(le))if(S.choices&&S.choices[0].context&&S.choices[0].context.data_points)S.choices[0].message=S.choices[0].delta,f=S;else if(S.choices&&S.choices[0].delta.content)Z(!1),await _t(S.choices[0].delta.content);else if(S.choices&&S.choices[0].context)f.choices[0].context={...f.choices[0].context,...S.choices[0].context};else if(S.error)throw Error(S.error)}finally{re(!1)}return{...f,choices:[{...f.choices[0],message:{content:A,role:f.choices[0].message.role}}]}},O=P?Q().instance:void 0,F=async i=>{E.current=i,ee&&ie(void 0),Z(!0),ce(void 0),G(void 0);const a=O?await me(O):void 0;try{const le={messages:[...w.flatMap(f=>[{content:f[0],role:"user"},{content:f[1].choices[0].message.content,role:"assistant"}]),{content:i,role:"user"}],stream:x,context:{overrides:{prompt_template:n.length===0?void 0:n,exclude_category:K.length===0?void 0:K,top:r,temperature:o,retrieval_mode:_,semantic_ranker:h,semantic_captions:k,suggest_followup_questions:J,use_oid_security_filter:Se,use_groups_security_filter:ve,vector_fields:He,use_gpt4v:X,gpt4v_input:Ce}},session_state:w.length?w[w.length-1][1].choices[0].session_state:null},A=await zs(le,a);if(!A.body)throw Error("No response body");if(x){const f=await nt(i,w,te,A.body);te([...w,[i,f]])}else{const f=await A.json();if(A.status>299||!A.ok)throw Error(f.error||"Unknown error");te([...w,[i,f]])}}catch(T){ie(T)}finally{Z(!1)}},ot=()=>{E.current="",ee&&ie(void 0),ce(void 0),G(void 0),te([]),ke([]),Z(!1),re(!1)};l.useEffect(()=>ae.current?.scrollIntoView({behavior:"smooth"}),[Y]),l.useEffect(()=>ae.current?.scrollIntoView({behavior:"auto"}),[Te]),l.useEffect(()=>{st()},[]);const at=(i,a)=>{c(a||"")},rt=(i,a,T)=>{u(i)},it=(i,a)=>{d(parseInt(a||"3"))},ct=(i,a)=>{m(!!a)},lt=(i,a)=>{ye(!!a)},ut=(i,a)=>{y(!!a)},dt=(i,a)=>{W(a||"")},ht=(i,a)=>{Ve(!!a)},pt=(i,a)=>{Qe(!!a)},gt=(i,a)=>{Ke(!!a)},mt=i=>{F(i)},Le=(i,a)=>{je===i&&z===L.CitationTab&&$===a?G(void 0):(ce(i),G(L.CitationTab)),we(a)},V=(i,a)=>{G(z===i&&$===a?void 0:i),we(a)};return e.jsxs("div",{className:p.container,children:[e.jsxs("div",{className:p.commandsContainer,children:[e.jsx(Bn,{className:p.commandButton,onClick:ot,disabled:!E.current||Y}),e.jsx(qn,{className:p.commandButton,onClick:()=>s(!t)})]}),e.jsxs("div",{className:p.chatRoot,children:[e.jsxs("div",{className:p.chatContainer,children:[E.current?e.jsxs("div",{className:p.chatMessageStream,children:[be&&Te.map((i,a)=>e.jsxs("div",{children:[e.jsx(se,{message:i[0]}),e.jsx("div",{className:p.chatMessageGpt,children:e.jsx(qe,{isStreaming:!0,answer:i[1],isSelected:!1,onCitationClicked:T=>Le(T,a),onThoughtProcessClicked:()=>V(L.ThoughtProcessTab,a),onSupportingContentClicked:()=>V(L.SupportingContentTab,a),onFollowupQuestionClicked:T=>F(T),showFollowupQuestions:J&&w.length-1===a},a)})]},a)),!be&&w.map((i,a)=>e.jsxs("div",{children:[e.jsx(se,{message:i[0]}),e.jsx("div",{className:p.chatMessageGpt,children:e.jsx(qe,{isStreaming:!1,answer:i[1],isSelected:$===a&&z!==void 0,onCitationClicked:T=>Le(T,a),onThoughtProcessClicked:()=>V(L.ThoughtProcessTab,a),onSupportingContentClicked:()=>V(L.SupportingContentTab,a),onFollowupQuestionClicked:T=>F(T),showFollowupQuestions:J&&w.length-1===a},a)})]},a)),Y&&e.jsxs(e.Fragment,{children:[e.jsx(se,{message:E.current}),e.jsx("div",{className:p.chatMessageGptMinWidth,children:e.jsx(sn,{})})]}),ee?e.jsxs(e.Fragment,{children:[e.jsx(se,{message:E.current}),e.jsx("div",{className:p.chatMessageGptMinWidth,children:e.jsx(nn,{error:ee.toString(),onRetry:()=>F(E.current)})})]}):null,e.jsx("div",{ref:ae})]}):e.jsxs("div",{className:p.chatEmptyState,children:[e.jsx(Yt,{fontSize:"120px",primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Chat logo"}),e.jsx("h1",{className:p.chatEmptyStateTitle,children:"Chat with your data"}),e.jsx("h2",{className:p.chatEmptyStateSubtitle,children:"Ask anything or try an example"}),e.jsx(mn,{onExampleClicked:mt,useGPT4V:X})]}),e.jsx("div",{className:p.chatInput,children:e.jsx(cn,{clearOnSend:!0,placeholder:"Type a new question (e.g. does my plan cover annual eye exams?)",disabled:Y,onSend:i=>F(i)})})]}),w.length>0&&z&&e.jsx(En,{className:p.chatAnalysisPanel,activeCitation:je,onActiveTabChanged:i=>V(i,$),citationHeight:"810px",answer:w[$][1],activeTab:z}),e.jsxs(Vt,{headerText:"Configure answer generation",isOpen:t,isBlocking:!1,onDismiss:()=>s(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e.jsx(Be,{onClick:()=>s(!1),children:"Close"}),isFooterAtBottom:!0,children:[e.jsx(pe,{className:p.chatSettingsSeparator,defaultValue:n,label:"Override prompt template",multiline:!0,autoAdjustHeight:!0,onChange:at}),e.jsx(Ht,{className:p.chatSettingsSeparator,label:"Temperature",min:0,max:1,step:.1,defaultValue:o,onChange:rt,showValue:!0,snapToStep:!0}),e.jsx(Dt,{className:p.chatSettingsSeparator,label:"Retrieve this many search results:",min:1,max:50,defaultValue:r.toString(),onChange:it}),e.jsx(pe,{className:p.chatSettingsSeparator,label:"Exclude category",onChange:dt}),Ye&&e.jsx(M,{className:p.chatSettingsSeparator,checked:h,label:"Use semantic ranker for retrieval",onChange:ct}),e.jsx(M,{className:p.chatSettingsSeparator,checked:k,label:"Use query-contextual summaries instead of whole documents",onChange:lt,disabled:!h}),e.jsx(M,{className:p.chatSettingsSeparator,checked:J,label:"Suggest follow-up questions",onChange:ht}),Ne&&e.jsx(Qn,{gpt4vInputs:Ce,isUseGPT4V:X,updateUseGPT4V:i=>{Je(i)},updateGPT4VInputs:i=>We(i)}),et&&e.jsx(Fn,{showImageOptions:X&&Ne,updateVectorFields:i=>De(i),updateRetrievalMode:i=>g(i)}),P&&e.jsx(M,{className:p.chatSettingsSeparator,checked:Se||D,label:"Use oid security filter",disabled:!ge(O)||D,onChange:pt}),P&&e.jsx(M,{className:p.chatSettingsSeparator,checked:ve||D,label:"Use groups security filter",disabled:!ge(O)||D,onChange:gt}),e.jsx(M,{className:p.chatSettingsSeparator,checked:x,label:"Stream chat completion responses",onChange:ut}),P&&e.jsx(Vn,{})]})]})]})};var xe;if(P){var R=new Tt(ns);!R.getActiveAccount()&&R.getAllAccounts().length>0&&R.setActiveAccount(R.getActiveAccount()),R.addEventCallback(t=>{if(t.eventType===kt.LOGIN_SUCCESS&&t.payload){const s=t.payload;R.setActiveAccount(s)}}),xe=e.jsx(Et,{instance:R,children:e.jsx(Me,{})})}else xe=e.jsx(Me,{});Nt();const Wn=Lt([{path:"/",element:xe,children:[{index:!0,element:e.jsx(Kn,{})},{path:"qa",lazy:()=>Ie(()=>import("./Ask-1f321492.js"),["assets/Ask-1f321492.js","assets/vendor-3b0eb66e.js","assets/fluentui-react-cc049b91.js","assets/fluentui-icons-cc979dd7.js","assets/Ask-9b33bc86.css"])},{path:"*",lazy:()=>Ie(()=>import("./NoPage-53567df7.js"),["assets/NoPage-53567df7.js","assets/vendor-3b0eb66e.js"])}]}]);At.createRoot(document.getElementById("root")).render(e.jsx(It.StrictMode,{children:e.jsx(Pt,{router:Wn})}));export{qe as A,mn as E,I as G,cn as Q,b as R,qn as S,Vn as T,N as V,L as a,nn as b,En as c,Qn as d,Fn as e,Us as f,me as g,eo as h,ge as i,D as r,P as u};
//# sourceMappingURL=index-21dc70bb.js.map
